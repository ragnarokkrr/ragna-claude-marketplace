# ADR-0002: WebSocket for Real-Time Notifications

## Status
Accepted

## Context
The system requires real-time notifications when tasks are created, updated, or assigned. Users expect sub-second latency for collaborative features. We need to choose a mechanism for pushing updates from server to client.

**Options Considered:**
1. **WebSocket (Socket.io or native WS)** - Full-duplex persistent connection
2. **Server-Sent Events (SSE)** - Unidirectional server-to-client streaming
3. **Long Polling** - Repeated HTTP requests with timeout
4. **GraphQL Subscriptions** - WebSocket-based with GraphQL layer

**Evaluation Criteria:**
- Real-time latency (target: <1 second)
- Browser compatibility
- Mobile support
- Connection scalability (10K concurrent users)
- Development complexity

## Decision
We will use **WebSocket with Socket.io library**.

Implementation approach:
- Socket.io for WebSocket abstraction with fallback support
- Redis adapter for multi-instance WebSocket support
- Room-based subscriptions per organization and user
- JWT authentication on WebSocket handshake
- Heartbeat/keepalive for connection health

## Consequences

### Positive
- **Low Latency**: <100ms notification delivery for connected clients
- **Bidirectional**: Enables future features like typing indicators, presence
- **Broad Support**: Socket.io provides fallbacks for older browsers
- **Mature Ecosystem**: Socket.io handles reconnection, heartbeats automatically
- **Scalable**: Redis adapter enables multi-instance deployment

### Negative
- **Stateful Connections**: Requires sticky sessions or shared state (Redis)
- **Connection Overhead**: Each user maintains persistent connection
- **Complexity**: More complex than simple HTTP polling

### Risks & Mitigations
- **Risk**: Connection scaling challenges at high user count
  - **Mitigation**: Use Redis adapter for horizontal scaling, implement connection limits per user
- **Risk**: Mobile battery drain from persistent connection
  - **Mitigation**: Implement smart reconnection logic, allow users to disable real-time on mobile
- **Risk**: WebSocket connections blocked by corporate firewalls
  - **Mitigation**: Socket.io automatic fallback to long-polling

### Follow-up
- Load test 1,000+ concurrent WebSocket connections
- Implement connection monitoring and alerting
- Consider adding push notifications for mobile as fallback when app backgrounded
